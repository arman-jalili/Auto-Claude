# Step 9: Documentation Updates

## Objective
Update project documentation to include OpenCode CLI support, installation instructions, and usage examples.

## Files to Create

### 1. Documentation: OpenCode Guide

**File**: `guides/OPENCODE.md` (NEW)

```markdown
# OpenCode CLI Integration

This guide explains how to use Auto Claude with OpenCode CLI as an alternative to Claude Code CLI.

## Overview

Auto Claude supports two AI coding CLIs:

1. **Claude Code CLI** - The official Claude Code CLI by Anthropic
2. **OpenCode CLI** - An open-source alternative that supports multiple providers

## OpenCode CLI Features

OpenCode is a 100% open-source AI coding agent with these benefits:

- **Multi-Provider Support**: Use Claude, OpenAI (GPT), Google (Gemini), OpenCode Zen, or local models
- **Two Built-in Agents**:
  - `build` - Full access agent for development work
  - `plan` - Read-only agent for analysis and code exploration
- **Client/Server Architecture**: Run on your computer, drive remotely from any client
- **Shareable Sessions**: Share a link to any session for reference or debugging
- **Privacy First**: No code or context data is stored remotely

## Installation

### Option 1: Using npm (Recommended)

```bash
npm install -g opencode-ai@latest
```

### Option 2: Using brew (macOS and Linux)

```bash
brew install opencode
```

### Option 3: Using scoop (Windows)

```bash
scoop install opencode
```

### Option 4: Using bun or pnpm

```bash
bun install -g opencode-ai
# or
pnpm install -g opencode-ai
```

### Option 5: Using nix

```bash
nix run nixpkgs#opencode
```

## Configuration

### OpenCode Providers

OpenCode supports multiple AI providers. Choose one based on your needs:

| Provider | Description | Best For |
|---------|-------------|----------|
| **Claude** | Anthropic's Claude models | Complex reasoning, code generation |
| **OpenAI (GPT)** | OpenAI's GPT models | Quick iteration, mainstream models |
| **Google (Gemini)** | Google's Gemini models | Research, multimodal tasks |
| **OpenCode Zen** | OpenCode's optimized models | Balanced performance, cost-effective |
| **Local Models** | Run models locally (Ollama, etc.) | Privacy, offline usage |

### Authentication

#### For OAuth-Based Providers (Claude, OpenAI, Google)

```bash
# Run interactive login
opencode login

# Select your provider when prompted
# Follow OAuth flow in browser
```

#### For OpenCode Zen (API Key)

```bash
# Set provider
opencode config provider zen

# Set API key
opencode config apiKey YOUR_API_KEY_HERE

# Or use environment variable
export OPENCODE_PROVIDER=zen
export OPENCODE_API_KEY=YOUR_API_KEY_HERE
```

#### For Local Models

```bash
# Set provider
opencode config provider local

# Select local model
opencode config model
```

## Using OpenCode with Auto Claude

### Setting the Active CLI

You can select your preferred CLI in two ways:

#### Method 1: Desktop App

1. Open Auto Claude settings
2. Navigate to "AI CLI" section
3. Select "OpenCode" from the dropdown
4. Choose your provider (Claude, OpenAI, Google, Zen, or Local)
5. (Optional) Enter API key if using Zen provider
6. Click "Test Connection" to verify setup

#### Method 2: Environment Variable

```bash
# Set CLI provider
export CLI_PROVIDER=opencode

# Set OpenCode provider (optional, defaults to Claude)
export OPENCODE_PROVIDER=claude

# Run Auto Claude
python run.py --spec 001
```

#### Method 3: Command Line Flag

```bash
# Use --cli flag (overrides environment)
python run.py --spec 001 --cli opencode
```

#### Method 4: Project Settings File

Create or edit `.auto-claude/settings.json` in your project:

```json
{
  "cli": "opencode",
  "opencode": {
    "provider": "claude"
  }
}
```

## CLI Information Display

To check which CLI is active and view its configuration:

```bash
# Show CLI and authentication information
python run.py --info

# Output example:
# ============================================================
# CLI Configuration
# ============================================================
# CLI Type: opencode
# CLI Path: /usr/local/bin/opencode
# Auth Type: multi_provider
# OpenCode Provider: claude
# ============================================================
```

## Troubleshooting

### OpenCode CLI Not Found

**Problem**: "OpenCode CLI not found"

**Solutions**:

1. Install OpenCode:
   ```bash
   npm install -g opencode-ai
   ```

2. Verify installation:
   ```bash
   opencode --version
   ```

3. Check PATH:
   ```bash
   which opencode
   ```

### Authentication Errors

**Problem**: "No OpenCode authentication found"

**Solutions**:

1. **For OAuth providers** (Claude, OpenAI, Google):
   ```bash
   opencode login
   ```

2. **For OpenCode Zen**:
   ```bash
   # Sign up at https://opencode.ai/zen
   # Get your API key
   opencode config apiKey YOUR_API_KEY
   ```

3. **For local models**:
   ```bash
   opencode config provider local
   ```

### CLI Validation Failed

**Problem**: "OpenCode CLI validation failed"

**Possible Causes**:

1. **Not in PATH**: Ensure OpenCode is installed and in system PATH
2. **Version Mismatch**: Auto Claude requires OpenCode 1.0.0 or later
3. **Permission Issues**: Check executable permissions on Unix-like systems

**Solutions**:

```bash
# Check OpenCode version
opencode --version

# On Unix-like systems, ensure executable
chmod +x $(which opencode)

# Reinstall if needed
npm uninstall -g opencode-ai
npm install -g opencode-ai@latest
```

## Model Selection

OpenCode CLI handles model selection internally. Auto Claude respects OpenCode's model configuration:

- Use OpenCode CLI commands to change models: `opencode config model`
- Model settings are managed by OpenCode, not Auto Claude
- Auto Claude's model setting may not apply when using OpenCode

## Comparison: Claude Code vs OpenCode

| Feature | Claude Code | OpenCode |
|---------|--------------|----------|
| **Source** | Proprietary | Open Source (MIT) |
| **Providers** | Claude only | Claude, OpenAI, Google, Zen, Local |
| **Agents** | Single agent | Build + Plan agents |
| **Architecture** | Monolithic CLI | Client/Server |
| **Session Sharing** | No | Yes |
| **Desktop App** | Native app | Desktop app (beta) |
| **Terminal UI** | Basic | Advanced (neovim-inspired) |

## Best Practices

### When to Use Claude Code

- You already have a Claude Code subscription
- You need the official Claude Code desktop app
- You prefer Anthropic-only ecosystem
- Your organization uses Claude Code exclusively

### When to Use OpenCode

- You want to support multiple providers (OpenAI, Google, etc.)
- You prefer open-source software
- You want advanced terminal UI features
- You want session sharing capabilities
- You want to run local models

### Switching Between CLIs

Switching is supported and non-destructive:

1. Change CLI in settings or via `--cli` flag
2. Existing worktrees and specs are preserved
3. Authentication is managed separately for each CLI
4. No need to reinstall or reconfigure Auto Claude

## Additional Resources

- **OpenCode Website**: https://opencode.ai
- **OpenCode GitHub**: https://github.com/anomalyco/opencode
- **OpenCode Docs**: https://opencode.ai/docs
- **OpenCode Discord**: https://discord.gg/opencode
- **Auto Claude Issues**: Report integration issues at https://github.com/AndyMik90/Auto-Claude/issues

## Example Workflows

### Create and Run Spec with OpenCode

```bash
# Set provider (optional)
export CLI_PROVIDER=opencode
export OPENCODE_PROVIDER=claude

# Create spec interactively
python spec_runner.py --interactive

# Run spec with OpenCode
python run.py --spec 001

# Run with QA
python run.py --spec 001 --qa
```

### Multi-Agent Development

OpenCode's "build" agent is similar to Auto Claude's default agent configuration:

- Full filesystem access
- Tool usage for bash commands
- Code generation and editing
- Error handling and recovery

For complex multi-agent workflows, Auto Claude's agent system works seamlessly with OpenCode.

## FAQ

### Q: Can I use both Claude Code and OpenCode?

A: Yes, but not simultaneously. You can switch between them at any time in the settings or via command-line flags.

### Q: Does OpenCode work with all Auto Claude features?

A: OpenCode CLI works with most Auto Claude features:
- ✓ Spec creation and execution
- ✓ Agent parallel execution
- ✓ Task management
- ✓ Worktree isolation
- ✓ QA validation
- ✓ GitHub/GitLab integration
- ✓ Memory system (via MCP)

### Q: How do model settings work with OpenCode?

A: OpenCode manages its own model configuration. Set models via OpenCode CLI commands:
```bash
opencode config model claude-sonnet-4-20250514
```

### Q: Is OpenCode free?

A: OpenCode is open-source software, free to use. However, you still need:
- API access for providers (Claude, OpenAI, Google)
- Or OpenCode Zen subscription for optimized models
- Local models (requires your own hardware)

### Q: What if OpenCode can't connect?

A: Check:
1. OpenCode is installed: `opencode --version`
2. Provider authentication is configured: `opencode config`
3. API key is valid (if using Zen provider)
4. Network connectivity
5. Proxy settings (if applicable)
```

## Files to Modify

### 2. Project README

**File**: `README.md` (MODIFY)

Add OpenCode installation section:

```markdown
## Installation

### Prerequisites

Auto Claude requires one of the following AI coding CLIs:

- **Claude Code CLI** (default)
- **OpenCode CLI** (alternative)

Install Claude Code:
\`\`\`bash
npm install -g @anthropic-ai/claude-code
\`\`\`

Install OpenCode:
\`\`\`bash
npm install -g opencode-ai
\`\`\`

### CLI Selection

Auto Claude defaults to Claude Code CLI. To use OpenCode:

1. **Desktop App**: Settings → AI CLI → Select "OpenCode"
2. **CLI Flag**: `python run.py --cli opencode --spec 001`
3. **Environment Variable**: `CLI_PROVIDER=opencode python run.py --spec 001`
4. **Project Settings**: Add to `.auto-claude/settings.json`:
   \`\`\`json
   {
     "cli": "opencode",
     "opencode": {
       "provider": "claude"
     }
   }
   \`\`\`

See [guides/OPENCODE.md](guides/OPENCODE.md) for detailed OpenCode configuration.
```

## Documentation Checklist

- [x] Created comprehensive OpenCode guide
- [x] Added installation instructions for all platforms
- [x] Documented CLI selection methods
- [x] Added troubleshooting section
- [x] Provided comparison with Claude Code
- [x] Included FAQ section
- [ ] Updated main README.md with OpenCode installation
- [ ] Updated CLAUDE.md with CLI configuration notes
- [ ] Added OpenCode to architecture documentation
- [ ] Created quick start guide for OpenCode users

## Important Notes

1. **Non-Breaking**: Default CLI remains Claude Code (existing users unaffected)
2. **Clear Instructions**: Multiple methods for CLI selection (UI, CLI, config)
3. **Comprehensive Coverage**: Covers installation, configuration, troubleshooting
4. **Migration Path**: Easy to switch from Claude Code to OpenCode
5. **Provider Support**: Documents all OpenCode providers with use cases

## Next Steps

Proceed to **Step 10** to create comprehensive testing plan.
